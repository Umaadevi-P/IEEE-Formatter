<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormatFlow - AI Manuscript Formatter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
        }
        
        :root {
            --primary-orange: #FF6B35;
            --primary-orange-dark: #E55A2B;
            --primary-orange-light: #FF8C5F;
            --accent-green: #48BB78;
            --accent-green-light: #B2F5EA;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --text-light: #718096;
            --border-color: #E2E8F0;
            --bg-light: #F7FAFC;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes checkmark {
            0% {
                transform: scale(0) rotate(45deg);
            }
            50% {
                transform: scale(1.1) rotate(45deg);
            }
            100% {
                transform: scale(1) rotate(45deg);
            }
        }
        
        body {
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE8D6 100%);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        .app-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 40px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-image {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .auth-buttons {
            display: flex;
            gap: 12px;
        }
        
        .auth-btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
        }
        
        .login-btn {
            background: transparent;
            color: var(--primary-orange);
            border: 2px solid var(--primary-orange);
        }
        
        .login-btn:hover {
            background: rgba(255, 107, 53, 0.08);
            transform: translateY(-2px);
        }
        
        .signup-btn {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
        }
        
        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 107, 53, 0.35);
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            padding: 25px 40px;
            gap: 25px;
        }
        
        /* Left Panel */
        .left-panel {
            width: 320px;
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }
        
        .nav-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-orange);
        }
        
        .progress-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }
        
        .step:hover:not(.active):not(.disabled) {
            background: var(--bg-light);
            transform: translateX(5px);
        }
        
        .step.active {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE8D6 100%);
            border-color: var(--primary-orange);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
        }
        
        .step.completed {
            background: rgba(72, 187, 120, 0.05);
        }
        
        .step.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .step-number {
            width: 38px;
            height: 38px;
            min-width: 38px;
            border-radius: 50%;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-secondary);
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .step.active .step-number {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.3);
        }
        
        .step.completed .step-number {
            background: linear-gradient(135deg, var(--accent-green) 0%, #38A169 100%);
            color: white;
        }
        
        .step.completed .step-number::after {
            content: '✓';
        }
        
        .step-info h3 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 3px;
            color: var(--text-primary);
        }
        
        .step-info p {
            font-size: 0.82rem;
            color: var(--text-light);
        }
        
        /* Right Panel */
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .screen-container {
            flex: 1;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            display: none;
            animation: scaleIn 0.4s ease;
        }
        
        .screen-container.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Landing Screen */
        .landing-content {
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .landing-content h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }
        
        .landing-content > p {
            font-size: 1.15rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 0 0 40px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%);
            padding: 25px 18px;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.12);
            border-color: var(--primary-orange);
        }
        
        .feature-card i {
            font-size: 2.2rem;
            color: var(--primary-orange);
            margin-bottom: 12px;
        }
        
        .feature-card h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .feature-card p {
            font-size: 0.88rem;
            color: var(--text-light);
            line-height: 1.4;
        }
        
        /* === BLOB BUTTON === */
        .blob-btn {
            z-index: 1;
            position: relative;
            padding: 15px 42px;
            text-align: center;
            text-transform: uppercase;
            color: var(--primary-orange);
            font-size: 0.95rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            background-color: transparent;
            outline: none;
            border: none;
            transition: color 0.5s;
            cursor: pointer;
            border-radius: 30px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .blob-btn:before {
            content: "";
            z-index: 1;
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            border: 2px solid var(--primary-orange);
            border-radius: 30px;
        }
        .blob-btn:after {
            content: "";
            z-index: -2;
            position: absolute;
            left: 3px; top: 3px;
            width: 100%; height: 100%;
            transition: all 0.3s 0.2s;
            border-radius: 30px;
        }
        .blob-btn:hover {
            color: white;
        }
        .blob-btn:hover:after {
            transition: all 0.3s;
            left: 0; top: 0;
            border-radius: 30px;
        }
        .blob-btn__inner {
            z-index: -1;
            overflow: hidden;
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            border-radius: 30px;
            background: white;
        }
        .blob-btn__blobs {
            position: relative;
            display: block;
            height: 100%;
            filter: url('#goo');
        }
        .blob-btn__blob {
            position: absolute;
            top: 2px;
            width: 25%;
            height: 100%;
            background: var(--primary-orange);
            border-radius: 100%;
            transform: translate3d(0, 150%, 0) scale(1.7);
            transition: transform 0.45s;
        }
        @supports (filter: url('#goo')) {
            .blob-btn__blob {
                transform: translate3d(0, 150%, 0) scale(1.4);
            }
        }
        .blob-btn__blob:nth-child(1) { left: 0%;       transition-delay: 0s; }
        .blob-btn__blob:nth-child(2) { left: 25%;      transition-delay: 0.08s; }
        .blob-btn__blob:nth-child(3) { left: 50%;      transition-delay: 0.16s; }
        .blob-btn__blob:nth-child(4) { left: 75%;      transition-delay: 0.24s; }
        .blob-btn:hover .blob-btn__blob {
            transform: translateZ(0) scale(1.7);
        }
        @supports (filter: url('#goo')) {
            .blob-btn:hover .blob-btn__blob {
                transform: translateZ(0) scale(1.4);
            }
        }
        /* Variant: white blob button (for dark bg / upload success) */
        .blob-btn.blob-white {
            color: white;
            border-color: white;
        }
        .blob-btn.blob-white:before { border-color: white; }
        .blob-btn.blob-white .blob-btn__inner { background: rgba(255,255,255,0.1); }
        .blob-btn.blob-white .blob-btn__blob { background: white; }
        .blob-btn.blob-white:hover { color: var(--primary-orange); }
        
        .subtext {
            margin-top: 20px;
            font-size: 0.82rem;
            color: var(--text-light);
            line-height: 1.5;
        }
        
        /* Upload Screen */
        .upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 16px;
            padding: 60px;
            text-align: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #FAFAFA 0%, #F5F5F5 100%);
            cursor: pointer;
        }
        
        .upload-area.dragover {
            border-color: var(--primary-orange);
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE8D6 100%);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: var(--primary-orange);
            margin-bottom: 20px;
        }
        
        .upload-area h2 {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .upload-area p {
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 25px;
        }
        
        .upload-btn {
            /* alias — styled via .blob-btn */
            padding: 12px 32px;
            font-size: 0.95rem;
        }
        
        .success-continue-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 13px 32px;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 14px rgba(72, 187, 120, 0.3);
        }
        .success-continue-btn:hover {
            background: #38A169;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(72, 187, 120, 0.4);
        }

        .file-success {
            background: linear-gradient(135deg, var(--accent-green-light) 0%, #B2F5EA 100%);
            border-radius: 16px;
            padding: 30px;
            border-left: 5px solid var(--accent-green);
            animation: fadeInUp 0.5s ease;
            text-align: center;
        }
        
        .file-success h3 {
            color: var(--accent-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .file-success .check-icon {
            font-size: 1.5rem;
        }
        
        .file-success p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        /* Format Selection Screen */
        .format-selection {
            text-align: center;
        }
        
        .format-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .format-header p {
            color: var(--text-light);
            font-size: 1.05rem;
            margin-bottom: 40px;
        }
        
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .format-card {
            background: white;
            border: 3px solid var(--border-color);
            border-radius: 14px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }
        
        .format-card:hover:not(.disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.15);
            border-color: var(--primary-orange);
        }
        
        .format-card.selected {
            border-color: var(--primary-orange);
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE8D6 100%);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.2);
        }
        
        .format-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .format-card i {
            font-size: 3rem;
            color: var(--primary-orange);
            margin-bottom: 15px;
        }
        
        .format-card h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .format-card p {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .lock-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 0.75rem !important;
            color: var(--text-light);
            background: rgba(0,0,0,0.06);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex !important;
            align-items: center;
            justify-content: center;
            margin: 0 !important;
        }
        
        /* Template Selection Screen */
        .template-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .template-header h2 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .template-header p {
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .template-card {
            background: white;
            border: 3px solid var(--border-color);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }
        
        /* Per-template selected border colors */
        .template-card.selected { box-shadow: 0 12px 30px rgba(0,0,0,0.1); }
        .template-card[data-template="journal"].selected    { border-color: var(--primary-orange); box-shadow: 0 12px 30px rgba(255,107,53,0.22); }
        .template-card[data-template="conference"].selected { border-color: #4A5CDB;               box-shadow: 0 12px 30px rgba(74,92,219,0.22); }
        .template-card[data-template="technical"].selected  { border-color: #38A169;               box-shadow: 0 12px 30px rgba(56,161,105,0.22); }
        .template-card[data-template="research"].selected   { border-color: #9333EA;               box-shadow: 0 12px 30px rgba(147,51,234,0.22); }
        
        .template-preview {
            height: 320px;
            background: #F8F9FA;
            padding: 20px;
            border-bottom: 3px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .template-card[data-template="journal"].selected    .template-preview { border-bottom-color: var(--primary-orange); }
        .template-card[data-template="conference"].selected .template-preview { border-bottom-color: #4A5CDB; }
        .template-card[data-template="technical"].selected  .template-preview { border-bottom-color: #38A169; }
        .template-card[data-template="research"].selected   .template-preview { border-bottom-color: #9333EA; }
        
        .template-preview-content {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 6px;
            padding: 16px 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
        }
        
        /* Base bar — thin, airy */
        .preview-line {
            height: 5px;
            background: #DDE3EA;
            margin-bottom: 11px;
            border-radius: 3px;
        }
        
        .preview-line.title {
            width: 70%;
            height: 10px;
            background: var(--text-primary);
            margin: 0 auto 14px;
        }
        
        .preview-line.subtitle {
            width: 50%;
            height: 4px;
            margin: 0 auto 16px;
        }
        
        .preview-line.author {
            width: 40%;
            height: 4px;
            margin: 0 auto 11px;
        }
        
        .preview-block {
            border: 1px solid #E2E8F0;
            padding: 10px 9px;
            margin-bottom: 13px;
            border-radius: 4px;
            background: #F7FAFC;
        }
        
        .preview-heading {
            height: 6px;
            width: 30%;
            background: var(--text-primary);
            margin-bottom: 11px;
            border-radius: 3px;
        }
        
        .template-info {
            padding: 18px;
            text-align: center;
        }
        
        .template-info h3 {
            font-size: 1.1rem;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-weight: 700;
        }
        
        .template-info p {
            color: var(--text-light);
            font-size: 0.88rem;
            margin-bottom: 12px;
        }
        
        .template-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE8D6 100%);
            color: var(--primary-orange);
            border-radius: 20px;
            font-size: 0.82rem;
            font-weight: 600;
        }
        
        .template-card.recommended {
            box-shadow: 0 4px 16px rgba(0,0,0,0.07);
        }

        .recommended-badge {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%) !important;
            color: white !important;
        }
        
        .template-card.selected .template-badge {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
        }
        
        /* Loading Screen */
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 25px;
            padding: 60px 0;
        }
        
        .spinner {
            width: 70px;
            height: 70px;
            border: 5px solid var(--border-color);
            border-top: 5px solid var(--primary-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.4rem;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .loading-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
            max-width: 400px;
        }
        
        .loading-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--border-color);
            opacity: 0.3;
            transition: all 0.3s ease;
        }
        
        .loading-step.active {
            opacity: 1;
            border-left-color: var(--primary-orange);
            animation: slideIn 0.3s ease;
        }
        
        .loading-step.completed {
            opacity: 1;
            border-left-color: var(--accent-green);
        }
        
        .loading-step i {
            font-size: 1.2rem;
            color: var(--primary-orange);
        }
        
        .loading-step.completed i {
            color: var(--accent-green);
        }
        
        /* Preview Screen */
        .preview-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .preview-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .hamburger-menu {
            display: flex;
            background: none;
            border: none;
            font-size: 1.3rem;
            color: var(--text-primary);
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .hamburger-menu:hover { background: var(--bg-light); }
        
        /* Hide left panel in preview mode */
        body.preview-mode .left-panel {
            display: none;
        }

        body.preview-mode .screen-container#preview-screen {
            padding: 20px 28px;
        }
        
        .preview-actions {
            display: flex;
            gap: 12px;
        }
        
        .action-btn {
            padding: 10px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 107, 53, 0.35);
        }
        
        .btn-secondary {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--bg-light);
        }
        
        .btn-icon-only {
            padding: 10px 12px;
        }
        
        .preview-content {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 20px;
            flex: 1;
            min-height: 0;
            align-items: start;
        }
        
        .document-viewer {
            background: #F0F0EC;
            border-radius: 14px;
            padding: 16px 16px 16px;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .document-preview {
            background: white;
            padding: 50px 52px;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            height: 600px;
            overflow-y: auto;
            font-family: 'Times New Roman', Times, serif !important;
            font-size: 13.5pt;
            line-height: 1.7;
            color: #111;
        }

        .document-preview * {
            font-family: 'Times New Roman', Times, serif !important;
        }

        .insights-panel {
            display: flex;
            flex-direction: column;
            gap: 14px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 160px);
            overflow-y: auto;
            padding-right: 2px;
        }
        
        .view-toggle {
            display: flex;
            gap: 4px;
            background: white;
            padding: 4px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        
        .toggle-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .toggle-btn.active {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(255, 107, 53, 0.25);
        }

        .insights-panel::-webkit-scrollbar { width: 4px; }
        .insights-panel::-webkit-scrollbar-track { background: transparent; }
        .insights-panel::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        
        .insight-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        }
        
        .insight-card h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insight-card h3 i {
            color: var(--primary-orange);
        }
        
        .view-toggle-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .compliance-score-card {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
            color: white;
        }
        
        .score-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .score-label {
            font-size: 1rem;
            font-weight: 700;
            color: white;
            line-height: 1.3;
        }
        
        .compliance-score {
            font-size: 3rem;
            font-weight: 800;
            color: white;
            line-height: 1;
        }
        
        .compliance-score-card p {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .improvements-card {
            background: linear-gradient(135deg, #1A1F2E 0%, #2D3548 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .improvements-card h3 {
            font-size: 0.85rem;
            font-weight: 700;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .improvements-card h3 i {
            color: var(--primary-orange);
        }

        .improvement-item {
            padding: 10px 14px;
            background: rgba(255,255,255,0.06);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-orange);
            cursor: default;
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

        .improvement-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(255,107,53,0.12) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .improvement-item:hover {
            transform: translateX(4px);
            background: rgba(255,255,255,0.1);
            border-left-color: #FF8C5F;
        }

        .improvement-item:hover::before {
            opacity: 1;
        }

        .improvement-item h4 {
            color: rgba(255,255,255,0.9);
            margin-bottom: 3px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .improvement-item p {
            color: rgba(255,255,255,0.45);
            font-size: 0.78rem;
            line-height: 1.4;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-row span:first-child {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .stat-row strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        /* Selection Menu */
        .selection-menu {
            position: fixed;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.18);
            padding: 8px;
            display: none;
            z-index: 9999;
            border: 1px solid var(--border-color);
            min-width: 210px;
            animation: scaleIn 0.15s ease;
        }
        
        .selection-menu.active {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .menu-item {
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-primary);
            white-space: nowrap;
        }
        
        .menu-item:hover {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE8D6 100%);
            color: var(--primary-orange);
        }
        
        .menu-item i {
            width: 18px;
            color: var(--primary-orange);
        }
        
        .menu-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }
        
        .menu-input {
            padding: 8px 16px;
        }
        
        .menu-input input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.88rem;
            transition: all 0.2s ease;
        }
        
        .menu-input input:focus {
            outline: none;
            border-color: var(--primary-orange);
        }
        
        /* Batch Upload */
        .batch-section {
            margin-top: 35px;
            padding-top: 35px;
            border-top: 2px dashed var(--border-color);
        }
        
        .batch-section h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        
        .batch-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            background: var(--bg-light);
        }
        
        .batch-file-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .batch-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 18px;
            background: white;
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }
        
        .remove-file-btn {
            background: none;
            border: none;
            color: #E53E3E;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        /* Mobile Drawer */
        .drawer-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .drawer-overlay.active {
            display: block;
        }
        
        .sidebar-drawer {
            position: fixed;
            top: 0;
            left: -350px;
            width: 320px;
            height: 100%;
            background: white;
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-drawer.open {
            left: 0;
        }
        
        .drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-drawer {
            background: none;
            border: none;
            font-size: 1.3rem;
            color: var(--text-light);
            cursor: pointer;
        }
        
        /* Document Styling */
        .document-title {
            font-size: 2.1rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 18px;
            color: var(--text-primary);
            line-height: 1.25;
        }
        
        .document-authors {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-style: italic;
        }
        
        .document-abstract {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            border-left: 4px solid var(--primary-orange);
        }
        
        .abstract-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-orange);
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }
        
        .section-content p {
            margin-bottom: 12px;
            line-height: 1.7;
            color: var(--text-secondary);
        }
        
        /* Responsive */
        @media (max-width: 968px) {
            .left-panel {
                display: none;
            }
            
            .hamburger-menu {
                display: block;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .screen-container {
                padding: 25px 18px;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .preview-content {
                grid-template-columns: 1fr;
            }
            
            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .template-grid, .format-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <img src="Logo.png" alt="FormatFlow Logo" class="logo-image" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;">
                <div class="logo-text">FormatFlow</div>
            </div>
            <div class="auth-buttons">
                <button class="auth-btn login-btn">Login</button>
                <button class="auth-btn signup-btn">Sign Up</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Navigation Panel -->
            <div class="left-panel">
                <div class="nav-title">Formatting Steps</div>
                <div class="progress-steps">
                    <div class="step active" data-screen="landing">
                        <div class="step-number">1</div>
                        <div class="step-info">
                            <h3>Get Started</h3>
                            <p>Upload your manuscript</p>
                        </div>
                    </div>
                    <div class="step disabled" data-screen="upload">
                        <div class="step-number">2</div>
                        <div class="step-info">
                            <h3>Upload Document</h3>
                            <p>Select your .docx file</p>
                        </div>
                    </div>
                    <div class="step disabled" data-screen="format">
                        <div class="step-number">3</div>
                        <div class="step-info">
                            <h3>Choose Format</h3>
                            <p>Select journal standard</p>
                        </div>
                    </div>
                    <div class="step disabled" data-screen="loading">
                        <div class="step-number">4</div>
                        <div class="step-info">
                            <h3>Processing</h3>
                            <p>AI formatting in progress</p>
                        </div>
                    </div>
                    <div class="step disabled" data-screen="preview">
                        <div class="step-number">5</div>
                        <div class="step-info">
                            <h3>Review & Download</h3>
                            <p>Verify and export</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Content Panel -->
            <div class="right-panel">
                <!-- Landing Screen -->
                <div class="screen-container active" id="landing-screen">
                    <div class="landing-content">
                        <h1>Your Research Deserves a Flawless First Impression</h1>
                        <p>Drop in your draft. Our AI handles the formatting — from structure to citations — so you can focus on what matters: your ideas.</p>
                        
                        <div class="feature-grid">
                            <div class="feature-card">
                                <i class="fas fa-brain"></i>
                                <h3>AI-Powered</h3>
                                <p>Gemini AI reads your paper like a reviewer, then formats it precisely</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-scroll"></i>
                                <h3>IEEE Ready</h3>
                                <p>Roman numerals, two-column layout, and proper heading hierarchy — auto-applied</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-arrow-right-arrow-left"></i>
                                <h3>Any Format</h3>
                                <p>PDF, DOCX, or both — download in seconds, ready to submit</p>
                            </div>
                            <div class="feature-card">
                                <i class="fas fa-shield-halved"></i>
                                <h3>Confidence Score</h3>
                                <p>See exactly how well your paper aligns with journal standards</p>
                            </div>
                        </div>
                        
                        <button class="blob-btn" onclick="navigateToScreen('upload')">
                            <i class="fas fa-rocket"></i> Start Formatting Now
                            <span class="blob-btn__inner">
                                <span class="blob-btn__blobs">
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                </span>
                            </span>
                        </button>
                        
                        <p class="subtext">Used by researchers at 50+ universities. No sign-up required to try.</p>
                    </div>
                </div>

                <!-- Upload Screen -->
                <div class="screen-container" id="upload-screen">
                    <div id="upload-area-container">
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h2>Upload Your Manuscript</h2>
                            <p>Drag and drop your .docx file here, or click to browse</p>
                            <button class="blob-btn upload-btn" onclick="document.getElementById('file-input').click()">
                                <i class="fas fa-folder-open"></i> Choose File
                                <span class="blob-btn__inner">
                                    <span class="blob-btn__blobs">
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                    </span>
                                </span>
                            </button>
                            <input type="file" id="file-input" accept=".docx" style="display: none;">
                        </div>
                    </div>
                    
                    <div class="batch-section">
                        <h3><i class="fas fa-layer-group"></i> Batch Upload (Multiple Files)</h3>
                        <div class="batch-upload-area">
                            <p style="color: var(--text-light); margin-bottom: 12px;">Upload multiple manuscripts at once</p>
                            <button class="blob-btn upload-btn" onclick="document.getElementById('batch-file-input').click()">
                                <i class="fas fa-layer-group"></i> Add Multiple Files
                                <span class="blob-btn__inner">
                                    <span class="blob-btn__blobs">
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                    </span>
                                </span>
                            </button>
                            <input type="file" id="batch-file-input" accept=".docx" multiple style="display: none;">
                        </div>
                        <div class="batch-file-list" id="batch-file-list"></div>
                    </div>
                </div>

                <!-- Format Selection Screen -->
                <div class="screen-container" id="format-screen">
                    <div class="format-selection">
                        <div class="format-header">
                            <h2>Choose Journal Format</h2>
                            <p>Select the academic standard for your manuscript</p>
                        </div>
                        
                        <div class="format-grid">
                            <div class="format-card selected" onclick="selectFormat('ieee')">
                                <i class="fas fa-bolt"></i>
                                <h3>IEEE</h3>
                                <p>Institute of Electrical and Electronics Engineers</p>
                            </div>
                            <div class="format-card disabled">
                                <i class="fas fa-lock lock-icon"></i>
                                <i class="fas fa-book"></i>
                                <h3>Springer</h3>
                                <p>Coming Soon</p>
                            </div>
                            <div class="format-card disabled">
                                <i class="fas fa-lock lock-icon"></i>
                                <i class="fas fa-graduation-cap"></i>
                                <h3>ACM</h3>
                                <p>Coming Soon</p>
                            </div>
                            <div class="format-card disabled">
                                <i class="fas fa-lock lock-icon"></i>
                                <i class="fas fa-flask"></i>
                                <h3>Elsevier</h3>
                                <p>Coming Soon</p>
                            </div>
                        </div>
                        
                        <button class="blob-btn" id="continue-format-btn" onclick="navigateToScreen('template')">
                            Continue to Template Selection →
                            <span class="blob-btn__inner">
                                <span class="blob-btn__blobs">
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                </span>
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Template Selection Screen -->
                <div class="screen-container" id="template-screen">
                    <div class="template-selection">
                        <div class="template-header">
                            <h2>Choose Your IEEE Template</h2>
                            <p>Select the format that best matches your target journal</p>
                        </div>
                        
                        <div class="template-grid">
                            <!-- Template 1: Journal Article - RECOMMENDED FIRST -->
                            <div class="template-card recommended" data-template="journal" onclick="selectTemplate('journal')">
                                <div class="template-preview" style="background: linear-gradient(160deg, #FFF9F0 0%, #FFE8D6 100%);">
                                    <div class="template-preview-content">
                                        <!-- Wide centered title -->
                                        <div class="preview-line" style="width:82%; height:10px; background:#2D3748; margin:0 auto 6px; border-radius:3px;"></div>
                                        <!-- Author line -->
                                        <div class="preview-line" style="width:52%; height:4px; margin:0 auto 16px; background:#a0aec0;"></div>
                                        <!-- Abstract block full-width -->
                                        <div style="background:rgba(255,107,53,0.09); border:1px solid rgba(255,107,53,0.25); border-radius:4px; padding:9px 8px; margin-bottom:14px;">
                                            <div style="width:28%; height:5px; background:var(--primary-orange); border-radius:3px; margin-bottom:9px;"></div>
                                            <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                            <div style="width:88%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                        </div>
                                        <!-- Two-column body -->
                                        <div style="display:flex; gap:12px;">
                                            <div style="flex:1;">
                                                <div style="width:55%; height:5px; background:#718096; border-radius:3px; margin-bottom:9px;"></div>
                                                <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                                <div style="width:90%; height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                                <div style="width:80%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                            <div style="flex:1;">
                                                <div style="width:55%; height:5px; background:#718096; border-radius:3px; margin-bottom:9px;"></div>
                                                <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                                <div style="width:85%; height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                                <div style="width:70%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="template-info">
                                    <h3>Journal Article</h3>
                                    <p>IEEE Transactions — two-column full paper</p>
                                    <span class="template-badge recommended-badge"><i class="fas fa-star"></i> Recommended</span>
                                </div>
                            </div>

                            <!-- Template 2: Conference -->
                            <div class="template-card" data-template="conference" onclick="selectTemplate('conference')">
                                <div class="template-preview" style="background: #F0F4FF;">
                                    <div class="template-preview-content">
                                        <!-- Centered title -->
                                        <div style="width:72%; height:10px; background:#2D3748; border-radius:3px; margin:0 auto 14px;"></div>
                                        <!-- Two authors side by side -->
                                        <div style="display:flex; gap:12px; margin-bottom:16px;">
                                            <div style="flex:1; display:flex; flex-direction:column; align-items:center; gap:6px;">
                                                <div style="width:75%; height:4px; background:#a0aec0; border-radius:3px;"></div>
                                                <div style="width:55%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                            <div style="flex:1; display:flex; flex-direction:column; align-items:center; gap:6px;">
                                                <div style="width:75%; height:4px; background:#a0aec0; border-radius:3px;"></div>
                                                <div style="width:55%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                        </div>
                                        <!-- Abstract block -->
                                        <div style="background:#E8EEFF; border:1px solid #C5CEFF; border-radius:4px; padding:9px 8px; margin-bottom:14px;">
                                            <div style="width:32%; height:5px; background:#4A5CDB; border-radius:3px; margin-bottom:9px;"></div>
                                            <div style="height:4px; background:#c5cbf5; border-radius:3px; margin-bottom:7px;"></div>
                                            <div style="width:85%; height:4px; background:#c5cbf5; border-radius:3px;"></div>
                                        </div>
                                        <!-- Two-column body -->
                                        <div style="display:flex; gap:12px;">
                                            <div style="flex:1;">
                                                <div style="width:60%; height:5px; background:#4A5CDB; border-radius:3px; margin-bottom:9px;"></div>
                                                <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                                <div style="width:88%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                            <div style="flex:1;">
                                                <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px; margin-top:14px;"></div>
                                                <div style="width:80%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="template-info">
                                    <h3>Conference Paper</h3>
                                    <p>IEEE conference proceedings format</p>
                                    <span class="template-badge" style="background:#E8EEFF; color:#4A5CDB;"><i class="fas fa-users"></i> Conference</span>
                                </div>
                            </div>

                            <!-- Template 3: Technical Report -->
                            <div class="template-card" data-template="technical" onclick="selectTemplate('technical')">
                                <div class="template-preview" style="background: #F0FFF4;">
                                    <div class="template-preview-content">
                                        <!-- Full-width green header bar -->
                                        <div style="height:8px; background:linear-gradient(90deg,#38A169,#48BB78); border-radius:3px; margin-bottom:13px;"></div>
                                        <!-- Left-aligned title -->
                                        <div style="width:78%; height:10px; background:#2D6A4F; border-radius:3px; margin-bottom:10px;"></div>
                                        <!-- Author + date on same line -->
                                        <div style="display:flex; gap:10px; margin-bottom:14px; align-items:center;">
                                            <div style="width:38%; height:4px; background:#68d391; border-radius:3px;"></div>
                                            <div style="width:22%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                        </div>
                                        <!-- Abstract block -->
                                        <div style="background:#E6FFED; border:1px solid #9AE6B4; border-radius:4px; padding:9px 8px; margin-bottom:14px;">
                                            <div style="width:35%; height:5px; background:#38A169; border-radius:3px; margin-bottom:9px;"></div>
                                            <div style="height:4px; background:#9AE6B4; border-radius:3px; margin-bottom:7px;"></div>
                                            <div style="width:88%; height:4px; background:#9AE6B4; border-radius:3px;"></div>
                                        </div>
                                        <!-- Single-column section heading + lines -->
                                        <div style="width:44%; height:5px; background:#38A169; border-radius:3px; margin-bottom:9px;"></div>
                                        <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                        <div style="width:92%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                    </div>
                                </div>
                                <div class="template-info">
                                    <h3>Technical Report</h3>
                                    <p>Workshops, white papers & proceedings</p>
                                    <span class="template-badge" style="background:#E6FFED; color:#38A169;"><i class="fas fa-cogs"></i> Technical</span>
                                </div>
                            </div>

                            <!-- Template 4: Medical/Research -->
                            <div class="template-card" data-template="research" onclick="selectTemplate('research')">
                                <div class="template-preview" style="background: #FDF0FF;">
                                    <div class="template-preview-content">
                                        <!-- Centered title -->
                                        <div style="width:85%; height:10px; background:#2D3748; border-radius:3px; margin:0 auto 10px;"></div>
                                        <!-- Author centered -->
                                        <div style="width:52%; height:4px; background:#a0aec0; border-radius:3px; margin:0 auto 16px;"></div>
                                        <!-- Structured abstract — labeled rows -->
                                        <div style="background:#F5E6FF; border:1px solid #D8B4FE; border-radius:4px; padding:9px 8px; margin-bottom:14px;">
                                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:9px;">
                                                <div style="width:24%; height:5px; background:#9333EA; border-radius:3px; flex-shrink:0;"></div>
                                                <div style="flex:1; height:4px; background:#d8b4fe; border-radius:3px;"></div>
                                            </div>
                                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:9px;">
                                                <div style="width:24%; height:5px; background:#9333EA; border-radius:3px; flex-shrink:0;"></div>
                                                <div style="flex:1; height:4px; background:#d8b4fe; border-radius:3px;"></div>
                                            </div>
                                            <div style="display:flex; align-items:center; gap:8px;">
                                                <div style="width:24%; height:5px; background:#9333EA; border-radius:3px; flex-shrink:0;"></div>
                                                <div style="flex:1; height:4px; background:#d8b4fe; border-radius:3px;"></div>
                                            </div>
                                        </div>
                                        <!-- Single section + lines -->
                                        <div style="width:38%; height:5px; background:#9333EA; border-radius:3px; margin-bottom:9px;"></div>
                                        <div style="height:4px; background:#DDE3EA; border-radius:3px; margin-bottom:7px;"></div>
                                        <div style="width:90%; height:4px; background:#DDE3EA; border-radius:3px;"></div>
                                    </div>
                                </div>
                                <div class="template-info">
                                    <h3>Medical / Research</h3>
                                    <p>Structured abstract with labeled sections</p>
                                    <span class="template-badge" style="background:#F5E6FF; color:#9333EA;"><i class="fas fa-microscope"></i> Research</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align:center; margin-top: 10px;">
                        <button class="blob-btn" id="continue-template-btn" style="opacity: 0.4; cursor: not-allowed; pointer-events:none;" disabled onclick="navigateToScreen('loading')">
                            Continue to Processing →
                            <span class="blob-btn__inner">
                                <span class="blob-btn__blobs">
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                    <span class="blob-btn__blob"></span>
                                </span>
                            </span>
                        </button>
                        </div>
                    </div>
                </div>

                <!-- Loading Screen -->
                <div class="screen-container" id="loading-screen">
                    <div class="loading-screen">
                        <div class="spinner"></div>
                        <div class="loading-text">AI is formatting your document...</div>
                        <div class="loading-steps">
                            <div class="loading-step" id="load-step-1">
                                <i class="fas fa-check-circle"></i>
                                <span>Analyzing document structure</span>
                            </div>
                            <div class="loading-step" id="load-step-2">
                                <i class="fas fa-circle"></i>
                                <span>Applying IEEE formatting rules</span>
                            </div>
                            <div class="loading-step" id="load-step-3">
                                <i class="fas fa-circle"></i>
                                <span>Converting headings to Roman numerals</span>
                            </div>
                            <div class="loading-step" id="load-step-4">
                                <i class="fas fa-circle"></i>
                                <span>Optimizing layout and spacing</span>
                            </div>
                            <div class="loading-step" id="load-step-5">
                                <i class="fas fa-circle"></i>
                                <span>Finalizing compliance check</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Screen -->
                <div class="screen-container" id="preview-screen">
                    <div class="preview-container">
                        <div class="preview-header">
                            <div class="preview-title">
                                <button class="hamburger-menu" id="menu-toggle-preview">
                                    <i class="fas fa-bars"></i>
                                </button>
                                Formatted Manuscript Preview
                            </div>
                            <div class="preview-actions">
                                <button class="action-btn btn-secondary btn-icon-only" id="redo-btn" title="Reformat">
                                    <i class="fas fa-redo"></i>
                                </button>
                                <button class="action-btn btn-primary" id="download-btn">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                        
                        <div class="view-toggle-bar">
                            <div class="view-toggle">
                                <button class="toggle-btn" id="btn-before" onclick="switchView('before')">
                                    <i class="fas fa-file"></i> Before
                                </button>
                                <button class="toggle-btn active" id="btn-after" onclick="switchView('after')">
                                    <i class="fas fa-pen"></i> After
                                </button>
                            </div>
                        </div>
                        <div class="preview-content">
                            <div class="document-viewer">
                                <div class="document-preview" id="document-preview">
                                    <!-- Document content -->
                                </div>
                            </div>
                            
                            <div class="insights-panel">
                                <div class="insight-card compliance-score-card">
                                    <div class="score-header">
                                        <span class="score-label">Formatting<br>Confidence</span>
                                        <div class="compliance-score" id="score-value">94%</div>
                                    </div>
                                    <p>How closely your manuscript follows IEEE formatting guidelines</p>
                                </div>
                                
                                <div class="improvements-card">
                                    <h3><i class="fas fa-wand-magic-sparkles"></i> Improvements Applied</h3>
                                    <div id="improvements-list">
                                        <div class="improvement-item">
                                            <h4>Section Structure</h4>
                                            <p>Converted headings to IEEE Roman numeral format (I., II., III., ...)</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Academic Language</h4>
                                            <p>Refined tone and clarity across all body sections</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Author Formatting</h4>
                                            <p>Added IEEE membership designations</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Abstract Enhancement</h4>
                                            <p>Expanded with key methodologies and contributions</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Typography</h4>
                                            <p>Applied Times New Roman, 10pt body, proper spacing</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Reference Style</h4>
                                            <p>Reformatted citations to IEEE numbered bracket style</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Column Layout</h4>
                                            <p>Switched body text to IEEE two-column format</p>
                                        </div>
                                        <div class="improvement-item">
                                            <h4>Keyword Block</h4>
                                            <p>Added Index Terms section after Abstract</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="insight-card">
                                    <h3><i class="fas fa-info-circle"></i> Quick Stats</h3>
                                    <div class="stat-row">
                                        <span>Sections Detected:</span>
                                        <strong>8</strong>
                                    </div>
                                    <div class="stat-row">
                                        <span>References:</span>
                                        <strong>24</strong>
                                    </div>
                                    <div class="stat-row">
                                        <span>Word Count:</span>
                                        <strong>3,456</strong>
                                    </div>
                                    <div class="stat-row">
                                        <span>Pages:</span>
                                        <strong>6</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Selection Menu -->
        <div class="selection-menu" id="selection-menu">
            <div class="menu-item" onclick="askAboutSelection()">
                <i class="fas fa-question-circle"></i>
                Ask about this change
            </div>
            <div class="menu-item" onclick="improveClarity()">
                <i class="fas fa-lightbulb"></i>
                Improve clarity
            </div>
            <div class="menu-item" onclick="rewriteFormal()">
                <i class="fas fa-pen-fancy"></i>
                Rewrite formally
            </div>
            <div class="menu-item" onclick="changeSectionType()">
                <i class="fas fa-exchange-alt"></i>
                Change section type
            </div>
            <div class="menu-divider"></div>
            <div class="menu-input">
                <input type="text" placeholder="Type your instruction..." id="custom-instruction" onkeypress="handleCustomInstruction(event)">
            </div>
        </div>

        <!-- Mobile Drawer -->
        <div class="drawer-overlay" id="drawer-overlay"></div>
        <div class="sidebar-drawer" id="sidebar-drawer">
            <div class="drawer-header">
                <h3>Navigation</h3>
                <button class="close-drawer" id="close-drawer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 20px;">
                <div class="progress-steps">
                    <div class="step active" onclick="drawerGoTo('landing')">
                        <div class="step-number">1</div>
                        <div class="step-info">
                            <h3>Get Started</h3>
                            <p>Upload your manuscript</p>
                        </div>
                    </div>
                    <div class="step disabled" onclick="drawerGoTo('upload')">
                        <div class="step-number">2</div>
                        <div class="step-info">
                            <h3>Upload Document</h3>
                            <p>Select your .docx file</p>
                        </div>
                    </div>
                    <div class="step disabled" onclick="drawerGoTo('format')">
                        <div class="step-number">3</div>
                        <div class="step-info">
                            <h3>Choose Format</h3>
                            <p>Select journal standard</p>
                        </div>
                    </div>
                    <div class="step disabled" onclick="drawerGoTo('loading')">
                        <div class="step-number">4</div>
                        <div class="step-info">
                            <h3>Processing</h3>
                            <p>AI formatting in progress</p>
                        </div>
                    </div>
                    <div class="step disabled" onclick="drawerGoTo('preview')">
                        <div class="step-number">5</div>
                        <div class="step-info">
                            <h3>Review & Download</h3>
                            <p>Verify and export</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000';
        let currentResult = null;
        let selectedText = '';
        let visitedScreens = ['landing'];
        let selectedFormat = 'ieee';
        let selectedTemplate = null;
        let batchFiles = [];
        let uploadedFile = null; // Store the uploaded file for processing

        // Navigation
        function navigateToScreen(screenName) {
            document.querySelectorAll('.screen-container').forEach(s => s.classList.remove('active'));
            document.getElementById(screenName + '-screen').classList.add('active');
            
            // Toggle preview mode (hide left panel on preview)
            if (screenName === 'preview') {
                document.body.classList.add('preview-mode');
            } else {
                document.body.classList.remove('preview-mode');
            }
            
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
                if (step.getAttribute('data-screen') === screenName) {
                    step.classList.add('active');
                    step.classList.remove('disabled');
                }
            });
            
            if (!visitedScreens.includes(screenName)) visitedScreens.push(screenName);
            
            visitedScreens.forEach(visited => {
                const step = document.querySelector(`.step[data-screen="${visited}"]`);
                if (step) {
                    step.classList.remove('disabled');
                    step.classList.add('clickable');
                    if (visited !== screenName) step.classList.add('completed');
                }
            });
            
            if (screenName === 'loading') startLoadingAnimation();
        }

        document.querySelectorAll('.step').forEach(step => {
            step.addEventListener('click', function() {
                const screen = this.getAttribute('data-screen');
                if (visitedScreens.includes(screen)) navigateToScreen(screen);
            });
        });

        // File Upload
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadContainer = document.getElementById('upload-area-container');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.docx')) handleFileUpload(file);
        });
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFileUpload(file);
        });
        
        function handleFileUpload(file) {
            // Store the file for later processing
            uploadedFile = file;
            
            uploadContainer.innerHTML = `
                <div class="file-success">
                    <h3><i class="fas fa-check-circle check-icon"></i> File Uploaded Successfully!</h3>
                    <p>📄 ${file.name} (${(file.size / 1024).toFixed(2)} KB)</p>
                    <button class="success-continue-btn" onclick="navigateToScreen('format')">
                        Continue to Format Selection →
                    </button>
                </div>
            `;
        }

        // Batch Upload
        const batchFileInput = document.getElementById('batch-file-input');
        const batchFileList = document.getElementById('batch-file-list');
        
        batchFileInput.addEventListener('change', (e) => {
            Array.from(e.target.files).forEach(file => {
                if (file.name.endsWith('.docx')) {
                    batchFiles.push(file);
                    addBatchFileItem(file);
                }
            });
        });
        
        function addBatchFileItem(file) {
            const item = document.createElement('div');
            item.className = 'batch-file-item';
            item.innerHTML = `
                <div>
                    <i class="fas fa-file-word" style="color: var(--primary-orange); margin-right: 10px;"></i>
                    <strong>${file.name}</strong>
                    <span style="color: var(--text-light); margin-left: 10px;">(${(file.size / 1024).toFixed(2)} KB)</span>
                </div>
                <button class="remove-file-btn" onclick="removeBatchFile('${file.name}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            batchFileList.appendChild(item);
        }
        
        function removeBatchFile(fileName) {
            batchFiles = batchFiles.filter(f => f.name !== fileName);
            batchFileList.innerHTML = '';
            batchFiles.forEach(file => addBatchFileItem(file));
        }

        // Format Selection
        function selectFormat(format) {
            selectedFormat = format;
            document.querySelectorAll('.format-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        // Template Selection
        function selectTemplate(template) {
            selectedTemplate = template;
            document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            const btn = document.getElementById('continue-template-btn');
            btn.style.opacity = '1';
            btn.style.cursor = 'pointer';
            btn.style.pointerEvents = 'auto';
            btn.disabled = false;
        }

        // Loading Animation and Backend Processing
        async function startLoadingAnimation() {
            const steps = ['load-step-1', 'load-step-2', 'load-step-3', 'load-step-4', 'load-step-5'];
            let current = 0;
            
            const interval = setInterval(() => {
                if (current > 0) {
                    const prev = document.getElementById(steps[current - 1]);
                    prev.classList.remove('active');
                    prev.classList.add('completed');
                    prev.querySelector('i').className = 'fas fa-check-circle';
                }
                
                if (current < steps.length) {
                    document.getElementById(steps[current]).classList.add('active');
                    current++;
                }
            }, 350);
            
            // Process document with backend
            try {
                if (!uploadedFile) {
                    throw new Error('No file uploaded');
                }
                
                // Create FormData and upload to backend
                const formData = new FormData();
                formData.append('file', uploadedFile);
                
                const response = await fetch(`${API_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Upload failed');
                }
                
                const data = await response.json();
                currentResult = data.processing_result;
                
                // Wait for animation to complete
                setTimeout(() => {
                    clearInterval(interval);
                    // Mark all steps as completed
                    steps.forEach(stepId => {
                        const step = document.getElementById(stepId);
                        step.classList.remove('active');
                        step.classList.add('completed');
                        step.querySelector('i').className = 'fas fa-check-circle';
                    });
                    
                    displayResults(currentResult);
                    navigateToScreen('preview');
                }, Math.max(0, (steps.length * 350) - 1000)); // Ensure animation plays for at least the duration
                
            } catch (error) {
                clearInterval(interval);
                console.error('Error processing document:', error);
                alert(`Error processing document: ${error.message}\n\nPlease ensure the backend server is running on ${API_URL}`);
                navigateToScreen('upload');
            }
        }

        // Display results
        function renderSections(sections) {
            let html = '';
            sections.forEach(section => {
                const heading = section.formatted_heading || section.original_heading || '';
                const content = section.content || '';

                if (section.type === 'Title') {
                    html += `<h1 class="document-title">${heading || content}</h1>`;
                } else if (section.type === 'Authors') {
                    html += `<div class="document-authors">${content}</div>`;
                } else if (section.type === 'Affiliation') {
                    html += `<div class="document-authors" style="margin-top:-10px;">${content}</div>`;
                } else if (section.type === 'Abstract') {
                    html += `<div class="document-abstract">
                        <div class="abstract-title">${heading || 'Abstract'}</div>
                        <p>${content}</p>
                    </div>`;
                } else if (content || heading) {
                    html += `<div>
                        ${heading ? `<h2 class="section-title">${heading}</h2>` : ''}
                        ${content ? `<div class="section-content">${content.split('\n').map(p => `<p>${p}</p>`).join('')}</div>` : ''}
                    </div>`;
                    
                    // Render subsections if present
                    if (section.subsections && section.subsections.length > 0) {
                        section.subsections.forEach(subsection => {
                            const subHeading = subsection.formatted_heading || subsection.original_heading || '';
                            const subContent = subsection.content || '';
                            
                            html += `<div style="margin-left: 20px;">
                                ${subHeading ? `<h3 class="subsection-title" style="font-style: italic; font-size: 1rem; margin: 10px 0;">${subHeading}</h3>` : ''}
                                ${subContent ? `<div class="section-content">${subContent.split('\n').map(p => `<p>${p}</p>`).join('')}</div>` : ''}
                            </div>`;
                        });
                    }
                }
            });
            return html;
        }

        function displayResults(result) {
            document.getElementById('document-preview').innerHTML = renderSections(result.document_after.sections);
            enableTextSelection();
            
            const score = Math.round(result.compliance.score);
            document.getElementById('score-value').textContent = score + '%';
            
            document.getElementById('btn-after').classList.add('active');
            document.getElementById('btn-before').classList.remove('active');
        }

        function switchView(which) {
            if (!currentResult) return;

            document.getElementById('btn-before').classList.toggle('active', which === 'before');
            document.getElementById('btn-after').classList.toggle('active', which === 'after');

            const sections = (which === 'before') ? currentResult.document_before.sections : currentResult.document_after.sections;
            document.getElementById('document-preview').innerHTML = renderSections(sections);
            enableTextSelection();
        }

        // Text Selection Menu
        function enableTextSelection() {
            const preview = document.getElementById('document-preview');
            const menu = document.getElementById('selection-menu');
            let hideTimeout;
            let isListenerAttached = preview._selectionListenerAttached;
            if (isListenerAttached) return;
            preview._selectionListenerAttached = true;
            
            preview.addEventListener('mouseup', () => {
                clearTimeout(hideTimeout);
                setTimeout(() => {
                    const selection = window.getSelection();
                    selectedText = selection ? selection.toString().trim() : '';
                    
                    if (selectedText.length > 0) {
                        const range = selection.getRangeAt(0);
                        const rect = range.getBoundingClientRect();
                        
                        // Make visible first to measure, then position
                        menu.style.visibility = 'hidden';
                        menu.classList.add('active');
                        
                        const menuW = menu.offsetWidth || 230;
                        const menuH = menu.offsetHeight || 200;
                        
                        // Center horizontally over selection
                        let left = rect.left + rect.width / 2 - menuW / 2;
                        left = Math.max(8, Math.min(left, window.innerWidth - menuW - 8));
                        
                        // Try above first; if no room, go below
                        let top = rect.top - menuH - 10;
                        if (top < 8) top = rect.bottom + 10;
                        
                        menu.style.left = left + 'px';
                        menu.style.top = top + 'px';
                        menu.style.visibility = 'visible';
                    } else {
                        menu.classList.remove('active');
                    }
                }, 15);
            });
            
            document.addEventListener('mousedown', (e) => {
                if (!menu.contains(e.target) && !preview.contains(e.target)) {
                    hideTimeout = setTimeout(() => menu.classList.remove('active'), 80);
                }
            });
        }

        function askAboutSelection() {
            if (!selectedText) return;
            alert(`AI would analyze: "${selectedText}"\n\n(Demo mode)`);
        }

        function improveClarity() {
            if (!selectedText) return;
            alert(`Improving clarity for: "${selectedText}"\n\n(Demo mode)`);
        }

        function rewriteFormal() {
            if (!selectedText) return;
            alert(`Making more formal: "${selectedText}"\n\n(Demo mode)`);
        }

        function changeSectionType() {
            alert('Section type change - coming soon!');
        }

        function handleCustomInstruction(event) {
            if (event.key === 'Enter') {
                const instruction = event.target.value;
                if (instruction && selectedText) {
                    alert(`Custom: "${instruction}"\nFor: "${selectedText}"\n\n(Demo mode)`);
                    event.target.value = '';
                    document.getElementById('selection-menu').classList.remove('active');
                }
            }
        }

        // Mobile Drawer
        document.getElementById('menu-toggle-preview')?.addEventListener('click', () => {
            document.getElementById('sidebar-drawer').classList.add('open');
            document.getElementById('drawer-overlay').classList.add('active');
        });

        document.getElementById('close-drawer').addEventListener('click', closeDrawer);
        document.getElementById('drawer-overlay').addEventListener('click', closeDrawer);

        function closeDrawer() {
            document.getElementById('sidebar-drawer').classList.remove('open');
            document.getElementById('drawer-overlay').classList.remove('active');
        }

        function drawerGoTo(screenName) {
            closeDrawer();
            if (visitedScreens.includes(screenName)) navigateToScreen(screenName);
        }

        // Download & Redo
        document.getElementById('download-btn').addEventListener('click', async () => {
            if (!currentResult || !currentResult.metadata) {
                alert('No document to download. Please process a document first.');
                return;
            }
            
            try {
                // For now, show a message that export requires the document to be stored
                // In a full implementation, we would call the /export/docx endpoint
                alert('Download functionality requires persistent storage.\n\nThe formatted document has been processed successfully.\nTo enable downloads, the backend needs to implement document storage.');
                
                // Example of how it would work with full implementation:
                // const response = await fetch(`${API_URL}/export/docx`, {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({
                //         document_id: currentResult.metadata.document_id,
                //         format: 'docx'
                //     })
                // });
                // const blob = await response.blob();
                // const url = window.URL.createObjectURL(blob);
                // const a = document.createElement('a');
                // a.href = url;
                // a.download = 'formatted_document.docx';
                // a.click();
            } catch (error) {
                console.error('Error downloading document:', error);
                alert(`Error downloading document: ${error.message}`);
            }
        });

        document.getElementById('redo-btn').addEventListener('click', () => {
            if (confirm('Re-apply formatting? This will process the document again.')) {
                navigateToScreen('loading');
            }
        });

        navigateToScreen('landing');
    </script>
    <!-- SVG Goo Filter for Blob Buttons -->
    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position:absolute;width:0;height:0;">
        <defs>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"/>
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo"/>
                <feBlend in="SourceGraphic" in2="goo"/>
            </filter>
        </defs>
    </svg>
</body>
</html>
